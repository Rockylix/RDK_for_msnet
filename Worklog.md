# RDK_board_pro 工作日志

## 项目概览
基于地平线RDK开发板的嵌入式AI视觉项目，涵盖MSNet立体视觉深度估计、MIPI双目实时处理、多摄像头采集与显示等技术方向。

---

## 📅 日志索引

### 2026-01-26 | MSNet立体视觉深度估计 (汇总: 1.11~1.26)
**分类**: 算法 | **时间跨度**: 16天开发周期

**核心成果**:
- ✅ 实现RDK BPU板载推理，推理延迟 **36.93ms**
- ✅ 解决量化校准数据三重致命冲突（数值量程/内存排布/颜色通道）
- ✅ 修复NFS文件传输中断导致的模型损坏问题
- ✅ 完成Windows ↔ ARM双向文件共享环境搭建

**关键技术突破**:
1. **量化校准黄金法则**: 
   - 取消 `/255` 归一化，数据类型使用 uint8
   - 内存排布与 `input_layout_rt` 严格一致
   - 颜色空间与 `input_type_rt` 对齐（BGR）
   
2. **NFS传输陷阱**: 大文件(>100MB)必须等待传输完整，否则产生损坏文件

**性能指标**:
| 阶段 | 耗时 |
|------|------|
| 模型加载 | 262.11 ms |
| 预处理 | 97.04 ms |
| **BPU推理** | **36.93 ms** |
| 后处理 | 63.57 ms |
| **总计** | ~460 ms |

**遗留问题**:
- 模型加载时间较长（384×192模型需6.5s）
- 自定义MSNet模型推理质量待验证

**详细日志**: [daily/2026-01-26.md](daily/2026-01-26.md)

**Git提交**: `e5a47985` (量化校准问题最终解决)

---

### 2026-02-01 | RDK双摄像头实时显示
**分类**: 硬件

**核心成果**:
- ✅ 实现MIPI双摄像头实时采集与SSH X11转发显示
- ✅ 集成OpenCV进行YUV→BGR格式转换
- ✅ 采用Sensor降分辨率方案，达到30 FPS极限帧率
- ✅ 实现双路并行输出（640×480高清 + 320×240预览）

**技术路径**:
1. VIO摄像头配置 (1920×1080 → 640×480)
2. C代码改造为C++，链接OpenCV4库
3. VPS硬件编码尝试 ❌ (流ID冲突问题)
4. Sensor直接降分辨率方案 ✅

**性能测试结果**:
| 场景 | 帧率 |
|------|------|
| 极限帧率（无显示） | 30 FPS |
| SSH X11转发显示 | 4~5 FPS |
| 双路并行输出 | 30 FPS |

**关键发现**:
- SSH X11转发是性能瓶颈（占用大量CPU资源）
- YUV→BGR转换对帧率影响极小
- VPS流ID由分辨率区分，相同分辨率会导致冲突

**遗留问题**:
- VPS硬件加速未实现（流ID冲突未解决）
- SSH转发性能瓶颈未优化

**详细日志**: [daily/2026-02-01.md](daily/2026-02-01.md)

**Git提交**: `9d730316` (modules初始提交)

---

### 2026-02-03 | MIPI双目视觉实时深度估计
**分类**: 算法

**核心成果**:
- ✅ 打通MIPI双目摄像头到视差图的完整流程
- ✅ 实现双线程时间戳同步机制（误差<5ms）
- ✅ 将系统FPS从4提升至8（无SSH转发干扰）
- 🔄 曝光与白平衡同步尝试（未完成）

**技术实现**:
1. 使用 `std::thread` 并行获取两路图像
2. 基于条件变量的线程同步机制
3. 时间戳差异检测与重试策略（最多5次）

**性能指标**:
| 指标 | 数值 |
|------|------|
| SSH转发FPS | 4 |
| 无转发FPS | 8 |
| 时间戳同步精度 | <5ms |

**技术瓶颈分析**:
- 软件时间戳对齐无明显改善边缘破碎问题
- 需要硬件级AE/AWB同步（RDK SDK未提供API）
- Camera1与Camera2亮度、色温不一致

**遗留问题**:
1. **硬件级AE/AWB同步未实现**: 需要研究hbn框架传感器控制API
2. **双目标定缺失**: 需要标定板采集内参/外参矩阵
3. **双线程优化效果有限**: 需要硬件触发同步或主从模式

**详细日志**: [daily/2026-02-03.md](daily/2026-02-03.md)

**Git提交**: `9d730316` (modules)

---

### 2026-02-06 | 文档整理与更新
**分类**: 文档维护

**工作内容**:
- 整理项目README文档
- 更新日志图片路径至 `log/` 目录
- 补充推理结果说明与解决方案

**Git提交**: 
- `e5a4798` - Revise README with inference results and solutions
- `ae51922` - Update README.md
- `01a4557` - Change image paths in README to log directory

---

### 2026-02-09 | 工作日志系统建立
**分类**: 工具开发

**核心成果**:
- ✅ 建立worklog-daily自动化日志管理系统
- ✅ 实现三层Notion架构（项目页/日志汇总/技术经验库）
- ✅ 完成6个关键技术问题的知识库沉淀
- ✅ 添加Git版本控制与远程同步workflow

**Notion知识库条目**:
1. 🔴 VPS流ID冲突导致get_frame失败
2. 🔴 BPU_loadModel错误码-6000002（NFS文件损坏）
3. ⚡ 量化校准数据三重冲突解决（最关键）
4. 🟡 SSH X11转发导致FPS暴降(30→4)
5. 🟡 AE/AWB硬件同步缺失导致亮度不一致
6. 🟢 双线程时间戳同步机制实现

**技术栈**:
- Python脚本（日志分析与生成）
- Notion MCP（云端同步）
- Git版本控制

**Git提交**:
- `0125916` - Add worklog-daily skill with automated daily log generation
- `2a6da3c` - Update worklog-daily skill: Add Git version control workflow

---

## 🎯 技术经验总结

### 硬件调试
1. **VPS流ID冲突**: 同分辨率多路输入会导致流ID冲突，需要差异化分辨率配置
2. **MIPI双目同步**: 软件时间戳对齐效果有限，需要硬件级AE/AWB同步
3. **SSH X11转发性能**: 远程显示是严重性能瓶颈，建议使用低分辨率预览路

### 算法优化
1. **量化校准数据**: 必须与config配置严格一致（数据类型/内存排布/颜色空间）
2. **BPU推理性能**: 36.93ms推理延迟，预处理(97ms)和后处理(63ms)占比更高
3. **双线程采集**: 适合解决软件层面时间戳同步，硬件问题需硬件方案

### 系统配置
1. **NFS文件传输**: 大文件必须等待传输完整，建议传输后校验MD5
2. **Swap内存管理**: 过度扩展会导致系统服务崩溃（NTP等），应优化代码而非扩展Swap
3. **Remote-SSH开发**: VS Code + NFS双向共享实现高效远程开发

---

## 📊 项目统计

- **开发周期**: 2026-01-11 至今（约30天）
- **日志条目**: 4个主要里程碑
- **关键问题解决**: 6个
- **代码提交**: 15+ commits
- **性能提升**: FPS 4→8（双目系统），推理延迟 36.93ms

---

## 🔗 相关资源

- **Notion知识库**: [💡 技术经验库](https://www.notion.so/e6d1d3e8a48c4d97b26f96900e8402fb)
- **项目仓库**: github.com:Rockylix/RDK_for_msnet.git
- **技术文档**: 各子项目 README.md

---

## 📝 日志更新说明

本工作日志由 worklog-daily 技能自动维护，整合Git提交记录与项目笔记，实现本地Markdown与Notion云端的双重同步。

最后更新: 2026-02-09
